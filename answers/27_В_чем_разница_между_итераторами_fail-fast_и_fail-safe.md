Итераторы fail-fast и fail-safe отличаются способом обработки изменений в коллекции, которую они обходят.

Итераторы fail-fast были введены в Java 1.2 и выбрасывают исключение ConcurrentModificationException, если коллекция была изменена во время итерации. Такие итераторы быстро реагируют на изменения и обеспечивают согласованность коллекции и итератора. Однако, они не гарантируют, что обход будет завершен, если коллекция изменяется в процессе итерации. Поэтому, они не рекомендуются для использования в многопоточных приложениях.

Итераторы fail-safe, в свою очередь, были введены в Java 1.5 и не выбрасывают исключение, если коллекция была изменена во время итерации. Вместо этого, они создают копию коллекции на момент начала итерации и обходят эту копию, в то время как изменения в исходной коллекции не влияют на итератор. Таким образом, они гарантируют завершение итерации, но могут приводить к неожиданным результатам, если изменения в коллекции должны быть отражены в процессе итерации.

Выбор между итераторами fail-fast и fail-safe зависит от конкретных требований приложения. Если согласованность между коллекцией и итератором является критически важной, то следует использовать итераторы fail-fast. Если требуется безопасный обход коллекции без возможных проблем с блокировками и синхронизацией, то следует использовать итераторы fail-safe.

fail-fast поведение означает, что при возникновении ошибки или состояния, которое может привести к ошибке, система немедленно прекращает дальнейшую работу и уведомляет об этом. Использование fail-fast подхода позволяет избежать недетерминированного поведения программы в течение времени.

В Java Collections API некоторые итераторы ведут себя как fail-fast и выбрасывают ConcurrentModificationException, если после его создания была произведена модификация коллекции, т.е. добавлен или удален элемент напрямую из коллекции, а не используя методы итератора.

Реализация такого поведения осуществляется за счет подсчета количества модификаций коллекции (modification count):

при изменении коллекции счетчик модификаций так же изменяется;
при создании итератора ему передается текущее значение счетчика;
при каждом обращении к итератору сохраненное значение счетчика сравнивается с текущим, и, если они не совпадают, возникает исключение.